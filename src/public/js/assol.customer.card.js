$(document).ready(function(){function e(e){var t={};return $.each(e,function(e,o){var a=$("#"+o),s=a.is("div")?$(a).find("input:checked").val():$(a).val(),i=CustomerRecord[o];$.isBlank(s)&&$.isBlank(i)||s==i||(t[o]=isDateField(a)?toServerDate(s):s,CustomerRecord[o]=s)}),t}function t(e){$("#alertErrorMessage").text(e),$("#alertError").slideDown()}function o(e){$("#alertSuccessMessage").text(e),$("#alertSuccess").slideDown()}function a(){$("#alertError").hide(),$("#alertSuccess").hide()}$.CustomerCard={GetCustomerUpdateUrl:function(){return BaseUrl+"customer/"+CustomerID+"/update"},Init:function(){this.InitActions(),this.InitDynamicData(),this.InitTemplate()},InitActions:function(){$("#SavePersonalData").click(this.SavePersonalData),$("#SaveSelfDescription").click(this.SaveSelfDescription),$("#QuestionDescription").click(this.QuestionDescription),$("#SaveAdditionally").click(this.SaveAdditionally),$("#SaveRemove").click(this.SaveRemove),$("#SaveReservationContact").click(this.SaveReservationContact),$("#SaveSites").click(this.SaveSites),$("#SaveVideo").click(this.SaveVideoSites),$("#SavePhoto").click(this.SavePhoto),$("#SavePhotoAndVideo").click(this.SavePhotoAndVideo),$("#CustomerRemove").click(this.CustomerRemove),$("#CustomerMarkRemove").click(this.CustomerMarkRemove),$("#CustomerRestore").click(this.CustomerRestore),$("#SaveVerificationLink").click(function(){var e=$("#VerificationLink").val();e&&$.CustomerCard.SaveVideoLink(e,0)}),$("#SaveAmateurLink").click(function(){var e=$("#AmateurLink").val();e&&$.CustomerCard.SaveVideoLink(e,1)}),$(document).on("click",".action-remove-passport",function(e){confirmRemove(function(){$.CustomerCard.RemovePassportRecord($(e.target).attr("record"))})}),$(document).on("click",".action-remove-agreement",function(e){confirmRemove(function(){$.CustomerCard.RemoveAgreementRecord($(e.target).attr("record"))})}),$(document).on("click",".action-remove-question-photo",function(e){confirmRemove(function(){$.CustomerCard.RemoveQuestionPhotoRecord($(e.target).attr("record"))})}),$(document).on("click",".action-remove-site",function(e){var t=$(e.target).closest(".work-sites-block").attr("record"),o=$(e.target).attr("record");confirmRemove(function(){$.CustomerCard.RemoveSiteRecord(t,o)})}),$(document).on("click",".action-append-video-site",function(e){var t=$(e.target).closest(".work-sites-block").attr("video-site"),o=$(e.target).closest(".form-group").find("input").val(),a=$(e.target).closest("[video-type]").attr("video-type");$.CustomerCard.SaveVideoSiteLink(t,o,a)}),$(document).on("click",".action-remove-question",function(e){confirmRemove(function(){$.CustomerCard.RemoveQuestionRecord($(e.target).closest("[record]").attr("record"))})}),$(document).on("click",".action-save-answer",function(e){$.CustomerCard.SaveQuestionAnswer($(e.target).closest("button").attr("record"))}),$(document).on("click",".action-save-language",function(e){$.CustomerCard.SaveLanguageRecord($(e.target).closest("button").attr("record"))}),$(document).on("click",".action-remove-language",function(e){confirmRemove(function(){$.CustomerCard.RemoveLanguageRecord($(e.target).closest("button").attr("record"))})}),$(document).on("click",".action-save-children",function(e){$.CustomerCard.SaveChildrenRecord($(e.target).closest("button").attr("record"))}),$(document).on("click",".action-remove-children",function(e){confirmRemove(function(){$.CustomerCard.RemoveChildrenRecord($(e.target).closest("button").attr("record"))})}),$(document).on("click",".action-remove-story",function(e){confirmRemove(function(){$.CustomerCard.RemoveStoryRecord($(e.target).closest("button").attr("record"))})}),$(document).on("click",".action-save-email",function(e){$.CustomerCard.SaveEmailRecord($(e.target).closest("button").attr("record"))}),$(document).on("click",".action-remove-email",function(e){confirmRemove(function(){$.CustomerCard.RemoveEmailRecord($(e.target).closest("button").attr("record"))})}),$(document).on("click",".action-remove-video",function(e){confirmRemove(function(){$.CustomerCard.RemoveVideoRecord($(e.target).closest("button").attr("record"))})}),$(document).on("click",".action-remove-video-site",function(e){var t=$(e.target).closest(".work-sites-block").attr("id-site"),o=$(e.target).closest(".work-sites-block").attr("video-site");confirmRemove(function(){$.CustomerCard.RemoveVideoSiteRecord(t,o)})}),$(document).on("click",".action-remove-video-site-link",function(e){var t=$(e.target).closest(".work-sites-block").attr("video-site"),o=$(e.target).closest("button"),a=o.attr("video-link"),s=o.attr("video-type");confirmRemove(function(){$.CustomerCard.RemoveVideoSiteLinkRecord(t,a,s)})}),$(document).on("click",".action-remove-album",function(e){confirmRemove(function(){$.CustomerCard.RemoveAlbumRecord($(e.target).closest("div[record]").attr("record"))})}),$(document).on("click",".image-remove-btn",function(e){confirmRemove(function(){$.CustomerCard.RemoveImageAlbumRecord($(e.target).closest("div[id-cross]").attr("id-cross"))})}),$(document).on("change","#addClientAvatar",function(e){$("#AvatarForm").submit()}),$("#AvatarForm").ajaxForm(function(e){e.status?$.CustomerCard.RefreshAvatar(e.id,e.FileName):t(e.message)}),$.each(EmployeeRights,function(e,t){$("#employeeAccess_"+t.EmployeeID).click()}),$("#SaveEmployeeAccess").click(function(){function e(e){e.status?o("Права пользователя успешно сохранены"):t(e.message)}var a=[];$("#employeeAccess").find("input:checked").each(function(){a.push($(this).val())});var s={Customer:CustomerID,Employees:a};$.post(BaseUrl+"/customer/"+CustomerID+"/rights",s,e,"json")}),$('a[href="#Questions"]').on("shown.bs.tab",function(){$.each($("textarea[data-autoresize]"),function(){var e=this.offsetHeight-this.clientHeight,t=function(t){$(t).css("height","auto").css("height",t.scrollHeight+e)};t($(this)),$(this).on("keyup input",function(){t(this)}).removeAttr("data-autoresize")})}),$('a[href="#PhotoAndVideo"]').on("shown.bs.tab",function(){$.CustomerCard.ReloadVideoVerificationList(),$.CustomerCard.ReloadVideoAmateurList()}),$('a[href="#Photo"]').on("shown.bs.tab",function(){$.CustomerCard.ReloadAlbumList()}),$('a[href="#Video"]').on("shown.bs.tab",function(){$.CustomerCard.ReloadVideoSiteList()}),$('a[href="#Story"]').on("shown.bs.tab",function(){$.CustomerCard.ReloadStoryList()}),$('a[href="#Sites"]').on("shown.bs.tab",function(){$.CustomerCard.ReloadSiteList()})},InitDynamicData:function(){this.ReloadPassportList(),this.ReloadAgreementList(),this.ReloadQuestionPhotoList(),this.ReloadLanguageList(),this.ReloadChildrenList(),IsLoveStory||this.ReloadEmailList()},InitTemplate:function(){$("#agreementTemplate").template("agreementTemplate"),$("#albumTemplate").template("albumTemplate"),$("#emailTemplate").template("emailTemplate"),$("#passportTemplate").template("passportTemplate"),$("#questionTemplate").template("questionTemplate"),$("#questionPhotoTemplate").template("questionPhotoTemplate"),$("#videoTemplate").template("videoTemplate"),$("#languageTemplate").template("languageTemplate"),$("#childrenTemplate").template("childrenTemplate"),$("#storyTemplate").template("storyTemplate"),$("#siteTemplate").template("siteTemplate"),$("#videoSiteTemplate").template("videoSiteTemplate"),$("#videoSiteLinkTemplate").template("videoSiteLinkTemplate")},CustomerRemove:function(){confirmRemove(function(){function e(e){e.status?(alert("Запись успешно удалена"),window.location=BaseUrl+"customer"):t(e.message)}a();var o=BaseUrl+"customer/"+CustomerID+"/remove";$.post(o,{IsFull:!0},e,"json")},"Вы действительно хотите БЕЗВОЗВРАТНО удалить запись?")},CustomerMarkRemove:function(){confirmRemove(function(){function e(e){e.status?o("Запись успешно удалена"):t(e.message)}a();var s=BaseUrl+"customer/"+CustomerID+"/remove";$.post(s,{},e,"json")})},CustomerRestore:function(){function e(e){e.status?o("Запись успешно восстановлена"):t(e.message)}a();var s=BaseUrl+"customer/"+CustomerID+"/restore";$.post(s,{},e,"json")},RefreshAvatar:function(e,t){var o=e>0?BaseUrl+"thumb/?src=/files/images/"+t:BaseUrl+"public/img/avatar-example.png";$("#AvatarBig").attr("src",o),$("#AvatarCard").attr("src",o)},ReloadAgreementList:function(){this.ReloadData("#agreement","agreement","agreementTemplate",!0)},ReloadAlbumList:function(){this.ReloadData("#album-list","album","albumTemplate")},ReloadLanguageList:function(){this.ReloadData("#languageList","language","languageTemplate",{ID:0,CustomerID:CustomerID,LanguageID:0,Level:0})},ReloadChildrenList:function(){this.ReloadData("#childrenList","children","childrenTemplate",{ID:0,CustomerID:CustomerID,SexID:0,FIO:"",DOB:""})},ReloadPassportList:function(){this.ReloadData("#passport","passport","passportTemplate",{ID:0})},ReloadQuestionPhotoList:function(){this.ReloadData("#questionPhoto","question/photo","questionPhotoTemplate",{ID:0})},ReloadQuestionList:function(){this.ReloadData("#QuestionList","question","questionTemplate")},ReloadVideoVerificationList:function(){this.ReloadData("#VideoVerificationList","video_0","videoTemplate")},ReloadVideoAmateurList:function(){this.ReloadData("#VideoAmateurList","video_1","videoTemplate")},ReloadVideoSiteVerificationList:function(e){this.ReloadData("#VideoSiteVerificationList_"+e,"video/site/"+e+"/video_0","videoSiteLinkTemplate")},ReloadVideoSiteAmateurList:function(e){this.ReloadData("#VideoSiteAmateurList_"+e,"video/site/"+e+"/video_1","videoSiteLinkTemplate")},ReloadVideoSiteMailList:function(e){this.ReloadData("#VideoSiteMailList_"+e,"video/site/"+e+"/video_2","videoSiteLinkTemplate")},ReloadVideoSiteList:function(){this.ReloadData("#videoSiteList","video/site","videoSiteTemplate",null,function(){$(this).each(function(){$.CustomerCard.ReloadVideoSiteVerificationList(this.ID),$.CustomerCard.ReloadVideoSiteAmateurList(this.ID),$.CustomerCard.ReloadVideoSiteMailList(this.ID)})})},ReloadEmailList:function(){this.ReloadData("#emailList","email","emailTemplate",{ID:0,CustomerID:CustomerID,Email:"",Note:""})},ReloadSiteList:function(){this.ReloadData("#siteList","site","siteTemplate")},ReloadStoryList:function(){function e(){$("#storyList").find('input[type="file"]').filestyle({input:!1,buttonText:"",buttonName:"story-avatar",iconName:""}),$("#storyList").find("form").ajaxForm(function(e){e.status?(o("Запись успешно сохранена"),$.CustomerCard.ReloadStoryList()):t(e.message)}),$(function(){$('[data-toggle="story-popover"]').popover()})}this.ReloadData("#storyList","story","storyTemplate",{ID:0,CustomerID:CustomerID,SiteID:0,Date:"",Name:"",Note:"",Avatar:0},e)},ReloadData:function(e,o,a,s,i){function r(o){o.status?o.records&&($(e).empty(),$.tmpl(a,o.records).appendTo(e),s&&$.tmpl(a,s).appendTo(e),$("input:checked").change(),"function"==typeof i&&i.call(o.records)):t(o.message)}$(e).html("Загрузка данных...");var n=BaseUrl+"customer/"+CustomerID+"/"+o+"/data";$.post(n,{},r,"json")},RemoveAgreementRecord:function(e){function s(e){e.status?(o("Документ успешно удален"),$.CustomerCard.ReloadAgreementList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/agreement/"+e+"/remove";$.post(i,{},s,"json")},RemoveAlbumRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadAlbumList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/album/"+e+"/remove";$.post(i,{},s,"json")},RemoveImageAlbumRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadAlbumList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/album/cross/"+e+"/remove";$.post(i,{},s,"json")},RemoveLanguageRecord:function(e){function s(e){e.status?(o("Язык успешно удален"),$.CustomerCard.ReloadLanguageList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/language/"+e+"/remove";$.post(i,{},s,"json")},RemoveChildrenRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadChildrenList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/children/"+e+"/remove";$.post(i,{},s,"json")},RemoveEmailRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadEmailList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/email/"+e+"/remove";$.post(i,{},s,"json")},RemoveStoryRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadStoryList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/story/"+e+"/remove";$.post(i,{},s,"json")},RemovePassportRecord:function(e){function s(e){e.status?(o("Документ успешно удален"),$.CustomerCard.ReloadPassportList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/passport/"+e+"/remove";$.post(i,{},s,"json")},RemoveQuestionPhotoRecord:function(e){function s(e){e.status?(o("Изображение успешно удалено"),$.CustomerCard.ReloadQuestionPhotoList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/question/photo/"+e+"/remove";$.post(i,{},s,"json")},RemoveSiteRecord:function(e,s){function i(a){a.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadSiteList(),$("#WorkSite_"+e).click()):t(a.message)}a();var r=BaseUrl+"customer/"+CustomerID+"/site/"+s+"/remove";$.post(r,{},i,"json")},RemoveVideoSiteRecord:function(e,s){function i(a){a.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadVideoSiteList(),$("#VideoSite_"+e).click()):t(a.message)}a();var r=BaseUrl+"customer/"+CustomerID+"/video/site/"+s+"/remove";$.post(r,{},i,"json")},RemoveVideoSiteLinkRecord:function(e,s,i){function r(a){if(a.status)switch(o("Запись успешно удалена"),parseInt(i)){case 0:$.CustomerCard.ReloadVideoSiteVerificationList(e);break;case 1:$.CustomerCard.ReloadVideoSiteAmateurList(e);break;case 2:$.CustomerCard.ReloadVideoSiteMailList(e)}else t(a.message)}a();var n=BaseUrl+"customer/"+CustomerID+"/video/site/link/"+s+"/remove";$.post(n,{},r,"json")},RemoveVideoRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadVideoAmateurList(),$.CustomerCard.ReloadVideoVerificationList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/video/"+e+"/remove";$.post(i,{},s,"json")},RemoveQuestionRecord:function(e){function s(e){e.status?(o("Запись успешно удалена"),$.CustomerCard.ReloadQuestionList()):t(e.message)}a();var i=BaseUrl+"customer/"+CustomerID+"/question/"+e+"/remove";$.post(i,{},s,"json")},SavePersonalData:function(){function s(e){e.status?o("Личные данные успешно сохранены"):t(e.message)}a();var i=e(["SName","FName","MName","DOB","DateRegister","City","Postcode","Country","Address","Phone_1","Phone_2","Email","Forming","ProfessionOfDiploma","CurrentWork","Worship","MaritalStatus","PassportSeries","PassportNumber","Height","Weight","HairColor","EyeColor","BodyBuild","BodyBuildID","SizeFoot","Smoking","Alcohol"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SaveSelfDescription:function(){function s(e){e.status?o("Самоописание успешно сохранено"):t(e.message)}a();var i=e(["Temper","Interests","WishesForManAgeMin","WishesForManAgeMax","WishesForManWeight","WishesForManHeight","WishesForManText","WishesForManNationality"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},QuestionDescription:function(){function s(e){e.status?o("Вопросы успешно сохранены"):t(e.message)}a();var i=e(["Question"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SaveAdditionally:function(){function s(e){e.status?o("Дополнительная информация успешно сохранена"):t(e.message)}a();var i=e(["Additionally"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SaveRemove:function(){function s(e){e.status?o("Причина удаления успешно сохранена"):t(e.message)}a();var i=e(["ReasonForDeleted"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SaveQuestionAnswer:function(e){function s(e){e.status?(o("Ответ на вопрос успешно сохранен"),$.CustomerCard.ReloadQuestionList()):t(e.message)}a();var i={Answer:$("#Answer_"+e).val()};$.post(BaseUrl+"customer/"+CustomerID+"/question/"+e+"/update",{data:i},s,"json")},SaveLanguageRecord:function(e){function s(e){e.status?(o("Язык успешно сохранен"),$.CustomerCard.ReloadLanguageList()):t(e.message)}a();var i={RecordID:e,LanguageID:$("#Language_"+e).val(),Level:$("#LevelLanguage_"+e).find("input:radio:checked").val()};$.post(BaseUrl+"customer/"+CustomerID+"/language/save",i,s,"json")},SaveEmailRecord:function(e){function s(e){e.status?(o("E-Mail успешно сохранен"),$.CustomerCard.ReloadEmailList()):t(e.message)}a();var i={RecordID:e,Email:$("#Email_"+e).val(),Note:$("#Note_"+e).val()};$.post(BaseUrl+"customer/"+CustomerID+"/email/save",i,s,"json")},SaveChildrenRecord:function(e){function s(e){e.status?(o("Ребенок успешно сохранен"),$.CustomerCard.ReloadChildrenList()):t(e.message)}a();var i={RecordID:e,SexID:$("#ChildrenSex_"+e).find("input:radio:checked").val(),FIO:$("#ChildrenFIO_"+e).val(),Reside:IsLoveStory?$("#ChildrenReside_"+e).val():"",DOB:toServerDate($("#ChildrenDOB_"+e).val())};$.post(BaseUrl+"customer/"+CustomerID+"/children/save",i,s,"json")},SavePhoto:function(){function s(e){e.status?o("Данные успешно сохранены"):t(e.message)}a();var i=e(["DateLastPhotoSession"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SavePhotoAndVideo:function(){function s(e){e.status?o("Данные успешно сохранены"):t(e.message)}a();var i=e(["DateLastPhotoSession"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")},SaveVideoLink:function(e,s){function i(e){e.status?(o("Видео успешно добавлено"),s?$.CustomerCard.ReloadVideoAmateurList():$.CustomerCard.ReloadVideoVerificationList(),$(s?"#AmateurLink":"#VerificationLink").val("")):t(e.message)}a();var r={Type:s,Link:e};$.post(BaseUrl+"customer/"+CustomerID+"/video/add",r,i,"json")},SaveVideoSiteLink:function(e,s,i){function r(a){if(a.status)switch(o("Видео успешно добавлено"),parseInt(i)){case 0:$.CustomerCard.ReloadVideoSiteVerificationList(e),$("#VideoSiteVerificationLink_"+e).val("");break;case 1:$.CustomerCard.ReloadVideoSiteAmateurList(e),$("#VideoSiteAmateurLink_"+e).val("");break;case 2:$.CustomerCard.ReloadVideoSiteMailList(e),$("#VideoSiteMailLink_"+e).val("")}else t(a.message)}a();var n={Site:e,Type:i,Link:s};$.post(BaseUrl+"customer/"+CustomerID+"/video/site/link/add",n,r,"json")},SaveSites:function(){function e(e){e.status?(o("Список сайтов успешно сохранен"),e.insert&&$.CustomerCard.ReloadSiteList()):t(e.message)}a();var s=[];$("#WorkSite").find("input:checked").each(function(){s.push($(this).val())});var i=[];$(".note-site").each(function(){var e=$(this).val(),t=$(this).attr("record");i.push({id:t,note:e})});var r={sites:s,notes:i};$.post(BaseUrl+"customer/"+CustomerID+"/site/save",{data:r},e,"json")},SaveVideoSites:function(){function e(e){e.status?(o("Список сайтов успешно сохранен"),e.insert&&$.CustomerCard.ReloadVideoSiteList()):t(e.message)}a();var s=[];$("#VideoSite").find("input:checked").each(function(){s.push($(this).val())});var i={sites:s};$.post(BaseUrl+"customer/"+CustomerID+"/video/site/save",{data:i},e,"json")},SaveReservationContact:function(){function s(e){e.status?o("Информация о контактах успешно сохранена"):t(e.message)}a();var i=e(["ReservationContacts"]);$.isBlank(i)||$.post($.CustomerCard.GetCustomerUpdateUrl(),{data:i},s,"json")}},$.CustomerCard.Init(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(){a()}),$("body").on("hidden.bs.modal",".remoteModal",function(){$(this).removeData("bs.modal")})});