$(document).ready(function(){"use strict";$.AssolServices={Init:function(){this.InitActions(),this.InitDynamicData(),this.InitTemplate()},InitActions:function(){$(document).on("click","#btnShow, #EmployeeFilter input:radio",this.ReloadServiceLists),$(document).on("click",".action-western-send",function(e){e.preventDefault();var t=$(e.target).closest("td").attr("id-western");bootbox.confirm('Изменить флаг "'+(IsLoveStory?"% Кли-ки":"Выслали")+'" для услуги?',function(i){i&&$.AssolServices.SendWesternService(t,$(e.target).prop("checked")?0:1)})}),$(document).on("click",".action-western-per",function(e){e.preventDefault();var t=$(e.target).closest("td").attr("id-western");bootbox.confirm('Изменить флаг "% Пер-ка" для услуги?',function(i){i&&$.AssolServices.PerWesternService(t,$(e.target).prop("checked")?0:1)})}),$(document).on("click",".action-western-done",function(e){var t=$(e.target).closest("td").attr("id-western");bootbox.confirm("Поставить метку выполнения на услугу?",function(e){e&&$.AssolServices.DoneService(t,"western")})}),$(document).on("click",".action-meeting-done",function(e){var t=$(e.target).closest("td").attr("id-meeting");bootbox.confirm("Поставить метку выполнения на услугу?",function(e){e&&$.AssolServices.DoneService(t,"meeting")})}),$(document).on("click",".action-delivery-done",function(e){var t=$(e.target).closest("td").attr("id-delivery");bootbox.confirm("Поставить метку выполнения на услугу?",function(e){e&&$.AssolServices.DoneService(t,"delivery")})})},InitDynamicData:function(){this.ReloadServiceLists()},InitTemplate:function(){$("#westernTemplate").template("westernTemplate"),$("#meetingTemplate").template("meetingTemplate"),$("#deliveryTemplate").template("deliveryTemplate")},DoneService:function(e,t){function i(){$.AssolServices.ReloadServiceLists()}$.post(BaseUrl+"services/"+t+"/done",{id:e},i,"json")},SendWesternService:function(e,t){function i(){$.AssolServices.ReloadServiceLists()}$.post(BaseUrl+"services/western/send",{id:e,isSend:t},i,"json")},PerWesternService:function(e,t){function i(){$.AssolServices.ReloadServiceLists()}$.post(BaseUrl+"services/western/per",{id:e,isPer:t},i,"json")},FilterList:function(){var e="YYYY-MM-DD",t={},i=$("#date-start").data("DateTimePicker");i&&(t.start=i.date().format(e));var n=$("#date-end").data("DateTimePicker");n&&(t.end=n.date().format(e));var s=$("#EmployeeFilter");return s.length>0&&(t.employee=s.find("input:checked").val()),t},ReloadServiceLists:function(){var e=$.AssolServices.FilterList();$.AssolServices.ReloadWesternList(e),$.AssolServices.ReloadMeetingList(e),$.AssolServices.ReloadDeliveryList(e)},ReloadWesternList:function(e){this.ReloadData("#western-list","western","westernTemplate",e)},ReloadMeetingList:function(e){this.ReloadData("#meeting-list","meeting","meetingTemplate",e)},ReloadDeliveryList:function(e){this.ReloadData("#delivery-list","delivery","deliveryTemplate",e)},ReloadData:function(e,t,i,n){function s(t){t.status?t.records&&($(e).empty(),$.tmpl(i,t.records).appendTo(e)):showErrorAlert(t.message)}$(e).html("Загрузка данных..."),$.post(BaseUrl+"services/"+t+"/data",n||{},s,"json")}},$.AssolServices.Init()});